import os
import cv2
import numpy as np
import LoadData as ld
from sklearn.cluster import KMeans
from sklearn.svm import SVC
from sklearn.model_selection import train_test_split
from sklearn.metrics import accuracy_score
from sklearn.feature_extraction import image
from sklearn.preprocessing import StandardScaler
import pickle

dataset_root = 'train and test'

X_train, y_train = ld.load_data_and_labels(os.path.join(dataset_root, 'train'))
X_test, y_test = ld.load_data_and_labels(os.path.join(dataset_root, 'test'))

X_train = np.array(X_train)
X_test = np.array(X_test)

n_clusters = 100
kmeans = KMeans(n_clusters=n_clusters, random_state=42)
X_train_bow = kmeans.fit_transform(X_train)
X_test_bow = kmeans.transform(X_test)

svm_model = SVC(kernel='linear', C=1)
svm_model.fit(X_train_bow, y_train)

svm_predictions = svm_model.predict(X_test_bow)
svm_accuracy = accuracy_score(y_test, svm_predictions)
print(f"SVM Model Accuracy: {svm_accuracy}")

svm_model_filename = 'svm_model.pkl'
with open(svm_model_filename, 'wb') as f:
    pickle.dump(svm_model, f)

kmeans_model_filename = 'kmeans_model.pkl'
with open(kmeans_model_filename, 'wb') as f:
    pickle.dump(kmeans, f)

print(f"Models saved as {svm_model_filename} and {kmeans_model_filename}")
